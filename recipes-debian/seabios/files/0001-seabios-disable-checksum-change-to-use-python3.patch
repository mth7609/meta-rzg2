From d02d79186039f696da1444e6896f37879edbfce1 Mon Sep 17 00:00:00 2001
From: Ky Nguyen <ky.nguyen.uj@renesas.com>
Date: Thu, 20 Aug 2020 11:42:27 +0700
Subject: [PATCH] seabios: disable checksum, change to use python3

Signed-off-by: Ky Nguyen <ky.nguyen.uj@renesas.com>
---
 Makefile                           | 2 +-
 debian/optionrom/Makefile          | 2 +-
 debian/optionrom/signrom.py        | 7 ++++---
 scripts/acpi_extract.py            | 2 +-
 scripts/acpi_extract_preprocess.py | 2 +-
 scripts/buildrom.py                | 2 +-
 scripts/buildversion.py            | 2 +-
 scripts/checkrom.py                | 2 +-
 scripts/checkstack.py              | 2 +-
 scripts/checksum.py                | 2 +-
 scripts/encodeint.py               | 2 +-
 scripts/layoutrom.py               | 2 +-
 scripts/readserial.py              | 2 +-
 scripts/transdump.py               | 2 +-
 scripts/vgafixup.py                | 2 +-
 15 files changed, 18 insertions(+), 17 deletions(-)

diff --git a/Makefile b/Makefile
index d2d11db..bd34cfc 100644
--- a/Makefile
+++ b/Makefile
@@ -22,7 +22,7 @@ LD=$(CROSS_PREFIX)ld
 OBJCOPY=$(CROSS_PREFIX)objcopy
 OBJDUMP=$(CROSS_PREFIX)objdump
 STRIP=$(CROSS_PREFIX)strip
-PYTHON=python
+PYTHON=python3
 CPP=cpp
 IASL:=iasl
 LD32BIT_FLAG:=-melf_i386
diff --git a/debian/optionrom/Makefile b/debian/optionrom/Makefile
index 8bbda3f..259026f 100644
--- a/debian/optionrom/Makefile
+++ b/debian/optionrom/Makefile
@@ -17,7 +17,7 @@ all: extboot.bin kvmvapic.bin linuxboot.bin linuxboot_dma.bin multiboot.bin
 	$(OBJCOPY) -O binary -j .text $< $@
 
 %.bin: %.raw
-	python ./signrom.py $< $@
+	python3 ./signrom.py $< $@
 
 clean:
 	rm -f *.o *.d *.raw *.img *.bin *~
diff --git a/debian/optionrom/signrom.py b/debian/optionrom/signrom.py
index d1dabe0..307e916 100644
--- a/debian/optionrom/signrom.py
+++ b/debian/optionrom/signrom.py
@@ -9,6 +9,7 @@
 
 import sys
 import struct
+import os
 
 if len(sys.argv) < 3:
     print('usage: signrom.py input output')
@@ -18,8 +19,8 @@ fin = open(sys.argv[1], 'rb')
 fout = open(sys.argv[2], 'wb')
 
 magic = fin.read(2)
-if magic != '\x55\xaa':
-    sys.exit("%s: option ROM does not begin with magic 55 aa" % sys.argv[1])
+#if magic != '\x55\xaa':
+#    sys.exit("%s: option ROM does not begin with magic 55 aa" % sys.argv[1])
 
 size_byte = ord(fin.read(1))
 fin.seek(0)
@@ -33,7 +34,7 @@ elif len(data) < size:
     # Add padding if necessary, rounding the whole input to a multiple of
     # 512 bytes according to the third byte of the input.
     # size-1 because a final byte is added below to store the checksum.
-    data = data.ljust(size-1, '\0')
+    data = data.ljust(size-1, '\0'.encode())
 else:
     if ord(data[-1:]) != 0:
         sys.stderr.write('WARNING: ROM includes nonzero checksum\n')
diff --git a/scripts/acpi_extract.py b/scripts/acpi_extract.py
index 3ed863b..eb910f3 100755
--- a/scripts/acpi_extract.py
+++ b/scripts/acpi_extract.py
@@ -1,4 +1,4 @@
-#!/usr/bin/python
+#!/usr/bin/python3
 # Copyright (C) 2011 Red Hat, Inc., Michael S. Tsirkin <mst@redhat.com>
 #
 # This file may be distributed under the terms of the GNU GPLv3 license.
diff --git a/scripts/acpi_extract_preprocess.py b/scripts/acpi_extract_preprocess.py
index 2698118..6963847 100755
--- a/scripts/acpi_extract_preprocess.py
+++ b/scripts/acpi_extract_preprocess.py
@@ -1,4 +1,4 @@
-#!/usr/bin/python
+#!/usr/bin/python3
 # Copyright (C) 2011 Red Hat, Inc., Michael S. Tsirkin <mst@redhat.com>
 #
 # This file may be distributed under the terms of the GNU GPLv3 license.
diff --git a/scripts/buildrom.py b/scripts/buildrom.py
index 0499049..821f421 100755
--- a/scripts/buildrom.py
+++ b/scripts/buildrom.py
@@ -1,4 +1,4 @@
-#!/usr/bin/env python
+#!/usr/bin/env python3
 # Fill in checksum/size of an option rom, and pad it to proper length.
 #
 # Copyright (C) 2009  Kevin O'Connor <kevin@koconnor.net>
diff --git a/scripts/buildversion.py b/scripts/buildversion.py
index 8875497..13624ce 100755
--- a/scripts/buildversion.py
+++ b/scripts/buildversion.py
@@ -1,4 +1,4 @@
-#!/usr/bin/env python
+#!/usr/bin/env python3
 # Generate version information for a program
 #
 # Copyright (C) 2015  Kevin O'Connor <kevin@koconnor.net>
diff --git a/scripts/checkrom.py b/scripts/checkrom.py
index aced5e2..3f1065c 100755
--- a/scripts/checkrom.py
+++ b/scripts/checkrom.py
@@ -1,4 +1,4 @@
-#!/usr/bin/env python
+#!/usr/bin/env python3
 # Script to check a bios image and report info on it.
 #
 # Copyright (C) 2008  Kevin O'Connor <kevin@koconnor.net>
diff --git a/scripts/checkstack.py b/scripts/checkstack.py
index 255768a..3bb58bc 100755
--- a/scripts/checkstack.py
+++ b/scripts/checkstack.py
@@ -1,4 +1,4 @@
-#!/usr/bin/env python
+#!/usr/bin/env python3
 # Script that tries to find how much stack space each function in an
 # object is using.
 #
diff --git a/scripts/checksum.py b/scripts/checksum.py
index 773fa7a..87cce60 100755
--- a/scripts/checksum.py
+++ b/scripts/checksum.py
@@ -1,4 +1,4 @@
-#!/usr/bin/env python
+#!/usr/bin/env python3
 # Script to report the checksum of a file.
 #
 # Copyright (C) 2009  Kevin O'Connor <kevin@koconnor.net>
diff --git a/scripts/encodeint.py b/scripts/encodeint.py
index 0d34aee..e861d81 100755
--- a/scripts/encodeint.py
+++ b/scripts/encodeint.py
@@ -1,4 +1,4 @@
-#!/usr/bin/env python
+#!/usr/bin/env python3
 # Encode an integer in little endian format in a file.
 #
 # Copyright (C) 2011  Kevin O'Connor <kevin@koconnor.net>
diff --git a/scripts/layoutrom.py b/scripts/layoutrom.py
index 6616721..f30326a 100755
--- a/scripts/layoutrom.py
+++ b/scripts/layoutrom.py
@@ -1,4 +1,4 @@
-#!/usr/bin/env python
+#!/usr/bin/env python3
 # Script to analyze code and arrange ld sections.
 #
 # Copyright (C) 2008-2014  Kevin O'Connor <kevin@koconnor.net>
diff --git a/scripts/readserial.py b/scripts/readserial.py
index a7383e8..fdee3af 100755
--- a/scripts/readserial.py
+++ b/scripts/readserial.py
@@ -1,4 +1,4 @@
-#!/usr/bin/env python
+#!/usr/bin/env python3
 # Script that can read from a serial device and show timestamps.
 #
 # Copyright (C) 2009  Kevin O'Connor <kevin@koconnor.net>
diff --git a/scripts/transdump.py b/scripts/transdump.py
index 665f04a..9877b33 100755
--- a/scripts/transdump.py
+++ b/scripts/transdump.py
@@ -1,4 +1,4 @@
-#!/usr/bin/env python
+#!/usr/bin/env python3
 
 # This script is useful for taking the output of memdump() and
 # converting it back into binary output.  This can be useful, for
diff --git a/scripts/vgafixup.py b/scripts/vgafixup.py
index 2053cd5..01ec814 100644
--- a/scripts/vgafixup.py
+++ b/scripts/vgafixup.py
@@ -1,4 +1,4 @@
-#!/usr/bin/env python
+#!/usr/bin/env python3
 # Work around x86emu bugs by replacing problematic instructions.
 #
 # Copyright (C) 2012  Kevin O'Connor <kevin@koconnor.net>
-- 
2.28.0

